# Phase 9: 낙관적 UI 및 즉시 피드백

서버 응답 대기 없이 UI를 즉시 업데이트하여 네이티브 앱과 같은 즉각적인 피드백을 제공합니다. Phase 6의 캐싱 전략과 결합하여 최상의 사용자 경험을 구현합니다.

## 🎯 목표

- 서버 응답 전에 UI 즉시 업데이트 (Optimistic Updates)
- 네트워크 지연에도 빠르게 반응하는 사용자 경험
- 실패 시 자동 롤백으로 데이터 정합성 유지

## 📋 작업 목록

### 9.1 낙관적 UI 업데이트 구현

#### 우선순위 1: 즉각 반응 필수 기능

- [x] **즐겨찾기 토글 (북마크)** (`usePostFavorite`)
  - onMutate에서 캐시 즉시 업데이트 (`Bookmark[]` 타입)
  - onError에서 롤백 처리
  - disabled로 중복 클릭 방지 (반투명 효과 없음)

- [x] **즐겨찾기 토글 (폴더)** (`usePostFolderFavorite`)
  - Star 아이콘 클릭 시 즉시 채움/비움
  - 실패 시 이전 상태로 롤백

- [x] **북마크 삭제** (`useDeleteBookmark`)
  - 삭제 버튼 클릭 시 리스트에서 즉시 제거
  - 서버 응답 대기 없이 사라짐 애니메이션
  - 실패 시 리스트에 다시 복원
  - 성공 시 폴더 목록 invalidate (bookmark_count 동기화)

- [x] **폴더 삭제** (`useDeleteFolder`)
  - 폴더 리스트에서 즉시 제거
  - 실패 시 복원

#### 우선순위 2: 향상된 경험

- [x] **북마크 수정** (`usePatchBookmark`)
  - 제목, 메모 등 변경사항 즉시 반영
  - 실패 시 이전 값으로 복원
  - 폴더 변경 시에만 폴더 목록 invalidate

- [x] **폴더 수정** (`usePatchFolder`)
  - 폴더명 등 변경사항 즉시 반영
  - 실패 시 이전 값으로 복원

- [x] **폴더 생성** (`usePostFolder`)
  - 폴더 목록에 임시 ID로 즉시 추가
  - 생성 완료 후 서버 데이터 반영을 위한 무효화

- [x] **북마크 생성** (`usePostBookmark`)
  - 북마크 목록에 임시로 즉시 추가
  - 생성 완료 후 실제 데이터 및 폴더 카운트 동기화를 위한 무효화

---

---

## 💡 구현 요약

- **React Query 훅 활용**: `onMutate`, `onError`, `onSettled`를 사용하여 낙관적 업데이트와 서비스 정합성을 동시에 확보.
- **캐싱 전략 연계**: Phase 6의 영구 캐싱(`staleTime: Infinity`)과 시너지를 내어 네트워크 요청 최소화 및 즉각적인 UI 반영 실현.
- **정합성 유지**: 삭제/이동 등 연쇄 반응이 필요한 작업에 대해 전략적인 `invalidateQueries` 적용.
